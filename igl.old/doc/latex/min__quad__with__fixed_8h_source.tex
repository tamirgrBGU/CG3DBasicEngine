\hypertarget{min__quad__with__fixed_8h_source}{}\doxysection{min\+\_\+quad\+\_\+with\+\_\+fixed.\+h}
\label{min__quad__with__fixed_8h_source}\index{igl/min\_quad\_with\_fixed.h@{igl/min\_quad\_with\_fixed.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// This file is part of libigl, a simple c++ geometry processing library.}}
\DoxyCodeLine{2 \textcolor{comment}{//}}
\DoxyCodeLine{3 \textcolor{comment}{// Copyright (C) 2014 Alec Jacobson <alecjacobson@gmail.com>}}
\DoxyCodeLine{4 \textcolor{comment}{//}}
\DoxyCodeLine{5 \textcolor{comment}{// This Source Code Form is subject to the terms of the Mozilla Public License}}
\DoxyCodeLine{6 \textcolor{comment}{// v. 2.0. If a copy of the MPL was not distributed with this file, You can}}
\DoxyCodeLine{7 \textcolor{comment}{// obtain one at http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#ifndef IGL\_MIN\_QUAD\_WITH\_FIXED\_H}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#define IGL\_MIN\_QUAD\_WITH\_FIXED\_H}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include "{}igl\_inline.h"{}}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#define EIGEN\_YES\_I\_KNOW\_SPARSE\_MODULE\_IS\_NOT\_STABLE\_YET}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <Eigen/Core>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <Eigen/Dense>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <Eigen/Sparse>}}
\DoxyCodeLine{16 \textcolor{comment}{// Bug in unsupported/Eigen/SparseExtra needs iostream first}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <unsupported/Eigen/SparseExtra>}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{keyword}{namespace }igl}
\DoxyCodeLine{21 \{}
\DoxyCodeLine{22   \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{23   \textcolor{keyword}{struct }min\_quad\_with\_fixed\_data;}
\DoxyCodeLine{24   \textcolor{comment}{// Known Bugs: rows of Aeq **should probably** be linearly independent.}}
\DoxyCodeLine{25   \textcolor{comment}{// During precomputation, the rows of a Aeq are checked via QR. But in case}}
\DoxyCodeLine{26   \textcolor{comment}{// they're not then resulting probably will no longer be sparse: it will be}}
\DoxyCodeLine{27   \textcolor{comment}{// slow.}}
\DoxyCodeLine{28   \textcolor{comment}{//}}
\DoxyCodeLine{29   \textcolor{comment}{// MIN\_QUAD\_WITH\_FIXED Minimize a quadratic energy of the form}}
\DoxyCodeLine{30   \textcolor{comment}{//}}
\DoxyCodeLine{31   \textcolor{comment}{// trace( 0.5*Z'*A*Z + Z'*B + constant )}}
\DoxyCodeLine{32   \textcolor{comment}{//}}
\DoxyCodeLine{33   \textcolor{comment}{// subject to}}
\DoxyCodeLine{34   \textcolor{comment}{//}}
\DoxyCodeLine{35   \textcolor{comment}{//   Z(known,:) = Y, and}}
\DoxyCodeLine{36   \textcolor{comment}{//   Aeq*Z = Beq}}
\DoxyCodeLine{37   \textcolor{comment}{//}}
\DoxyCodeLine{38   \textcolor{comment}{// Templates:}}
\DoxyCodeLine{39   \textcolor{comment}{//   T  should be a eigen matrix primitive type like int or double}}
\DoxyCodeLine{40   \textcolor{comment}{// Inputs:}}
\DoxyCodeLine{41   \textcolor{comment}{//   A  n by n matrix of quadratic coefficients}}
\DoxyCodeLine{42   \textcolor{comment}{//   known list of indices to known rows in Z}}
\DoxyCodeLine{43   \textcolor{comment}{//   Y  list of fixed values corresponding to known rows in Z}}
\DoxyCodeLine{44   \textcolor{comment}{//   Aeq  m by n list of linear equality constraint coefficients}}
\DoxyCodeLine{45   \textcolor{comment}{//   pd flag specifying whether A(unknown,unknown) is positive definite}}
\DoxyCodeLine{46   \textcolor{comment}{// Outputs:}}
\DoxyCodeLine{47   \textcolor{comment}{//   data  factorization struct with all necessary information to solve}}
\DoxyCodeLine{48   \textcolor{comment}{//     using min\_quad\_with\_fixed\_solve}}
\DoxyCodeLine{49   \textcolor{comment}{// Returns true on success, false on error}}
\DoxyCodeLine{50   \textcolor{comment}{//}}
\DoxyCodeLine{51   \textcolor{comment}{// Benchmark: For a harmonic solve on a mesh with 325K facets, matlab 2.2}}
\DoxyCodeLine{52   \textcolor{comment}{// secs, igl/min\_quad\_with\_fixed.h 7.1 secs}}
\DoxyCodeLine{53   \textcolor{comment}{//}}
\DoxyCodeLine{54   \textcolor{keyword}{template} <\textcolor{keyword}{typename} T, \textcolor{keyword}{typename} Derivedknown>}
\DoxyCodeLine{55   IGL\_INLINE \textcolor{keywordtype}{bool} min\_quad\_with\_fixed\_precompute(}
\DoxyCodeLine{56     \textcolor{keyword}{const} Eigen::SparseMatrix<T>\& A,}
\DoxyCodeLine{57     \textcolor{keyword}{const} Eigen::MatrixBase<Derivedknown> \& known,}
\DoxyCodeLine{58     \textcolor{keyword}{const} Eigen::SparseMatrix<T>\& Aeq,}
\DoxyCodeLine{59     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} pd,}
\DoxyCodeLine{60     min\_quad\_with\_fixed\_data<T> \& data}
\DoxyCodeLine{61     );}
\DoxyCodeLine{62   \textcolor{comment}{// Solves a system previously factored using min\_quad\_with\_fixed\_precompute}}
\DoxyCodeLine{63   \textcolor{comment}{//}}
\DoxyCodeLine{64   \textcolor{comment}{// Template:}}
\DoxyCodeLine{65   \textcolor{comment}{//   T  type of sparse matrix (e.g. double)}}
\DoxyCodeLine{66   \textcolor{comment}{//   DerivedY  type of Y (e.g. derived from VectorXd or MatrixXd)}}
\DoxyCodeLine{67   \textcolor{comment}{//   DerivedZ  type of Z (e.g. derived from VectorXd or MatrixXd)}}
\DoxyCodeLine{68   \textcolor{comment}{// Inputs:}}
\DoxyCodeLine{69   \textcolor{comment}{//   data  factorization struct with all necessary precomputation to solve}}
\DoxyCodeLine{70   \textcolor{comment}{//   B  n by k column of linear coefficients}}
\DoxyCodeLine{71   \textcolor{comment}{//   Y  b by k list of constant fixed values}}
\DoxyCodeLine{72   \textcolor{comment}{//   Beq  m by k list of linear equality constraint constant values}}
\DoxyCodeLine{73   \textcolor{comment}{// Outputs:}}
\DoxyCodeLine{74   \textcolor{comment}{//   Z  n by k solution}}
\DoxyCodeLine{75   \textcolor{comment}{//   sol  \#unknowns+\#lagrange by k solution to linear system}}
\DoxyCodeLine{76   \textcolor{comment}{// Returns true on success, false on error}}
\DoxyCodeLine{77   \textcolor{keyword}{template} <}
\DoxyCodeLine{78     \textcolor{keyword}{typename} T,}
\DoxyCodeLine{79     \textcolor{keyword}{typename} DerivedB,}
\DoxyCodeLine{80     \textcolor{keyword}{typename} DerivedY,}
\DoxyCodeLine{81     \textcolor{keyword}{typename} DerivedBeq,}
\DoxyCodeLine{82     \textcolor{keyword}{typename} DerivedZ,}
\DoxyCodeLine{83     \textcolor{keyword}{typename} Derivedsol>}
\DoxyCodeLine{84   IGL\_INLINE \textcolor{keywordtype}{bool} min\_quad\_with\_fixed\_solve(}
\DoxyCodeLine{85     \textcolor{keyword}{const} min\_quad\_with\_fixed\_data<T> \& data,}
\DoxyCodeLine{86     \textcolor{keyword}{const} Eigen::MatrixBase<DerivedB> \& B,}
\DoxyCodeLine{87     \textcolor{keyword}{const} Eigen::MatrixBase<DerivedY> \& Y,}
\DoxyCodeLine{88     \textcolor{keyword}{const} Eigen::MatrixBase<DerivedBeq> \& Beq,}
\DoxyCodeLine{89     Eigen::PlainObjectBase<DerivedZ> \& Z,}
\DoxyCodeLine{90     Eigen::PlainObjectBase<Derivedsol> \& sol);}
\DoxyCodeLine{91   \textcolor{comment}{// Wrapper without sol}}
\DoxyCodeLine{92   \textcolor{keyword}{template} <}
\DoxyCodeLine{93     \textcolor{keyword}{typename} T,}
\DoxyCodeLine{94     \textcolor{keyword}{typename} DerivedB,}
\DoxyCodeLine{95     \textcolor{keyword}{typename} DerivedY,}
\DoxyCodeLine{96     \textcolor{keyword}{typename} DerivedBeq,}
\DoxyCodeLine{97     \textcolor{keyword}{typename} DerivedZ>}
\DoxyCodeLine{98   IGL\_INLINE \textcolor{keywordtype}{bool} min\_quad\_with\_fixed\_solve(}
\DoxyCodeLine{99     \textcolor{keyword}{const} min\_quad\_with\_fixed\_data<T> \& data,}
\DoxyCodeLine{100     \textcolor{keyword}{const} Eigen::MatrixBase<DerivedB> \& B,}
\DoxyCodeLine{101     \textcolor{keyword}{const} Eigen::MatrixBase<DerivedY> \& Y,}
\DoxyCodeLine{102     \textcolor{keyword}{const} Eigen::MatrixBase<DerivedBeq> \& Beq,}
\DoxyCodeLine{103     Eigen::PlainObjectBase<DerivedZ> \& Z);}
\DoxyCodeLine{104   \textcolor{keyword}{template} <}
\DoxyCodeLine{105     \textcolor{keyword}{typename} T,}
\DoxyCodeLine{106     \textcolor{keyword}{typename} Derivedknown,}
\DoxyCodeLine{107     \textcolor{keyword}{typename} DerivedB,}
\DoxyCodeLine{108     \textcolor{keyword}{typename} DerivedY,}
\DoxyCodeLine{109     \textcolor{keyword}{typename} DerivedBeq,}
\DoxyCodeLine{110     \textcolor{keyword}{typename} DerivedZ>}
\DoxyCodeLine{111   IGL\_INLINE \textcolor{keywordtype}{bool} min\_quad\_with\_fixed(}
\DoxyCodeLine{112     \textcolor{keyword}{const} Eigen::SparseMatrix<T>\& A,}
\DoxyCodeLine{113     \textcolor{keyword}{const} Eigen::MatrixBase<DerivedB> \& B,}
\DoxyCodeLine{114     \textcolor{keyword}{const} Eigen::MatrixBase<Derivedknown> \& known,}
\DoxyCodeLine{115     \textcolor{keyword}{const} Eigen::MatrixBase<DerivedY> \& Y,}
\DoxyCodeLine{116     \textcolor{keyword}{const} Eigen::SparseMatrix<T>\& Aeq,}
\DoxyCodeLine{117     \textcolor{keyword}{const} Eigen::MatrixBase<DerivedBeq> \& Beq,}
\DoxyCodeLine{118     \textcolor{keyword}{const} \textcolor{keywordtype}{bool} pd,}
\DoxyCodeLine{119     Eigen::PlainObjectBase<DerivedZ> \& Z);}
\DoxyCodeLine{120 }
\DoxyCodeLine{121   \textcolor{comment}{// Dense version optimized for very small, known at compile time sizes. Still}}
\DoxyCodeLine{122   \textcolor{comment}{// works for Eigen::Dynamic (and then everything needs to be Dynamic).}}
\DoxyCodeLine{123   \textcolor{comment}{//}}
\DoxyCodeLine{124   \textcolor{comment}{// min\_x ½ xᵀ H x + xᵀ f}}
\DoxyCodeLine{125   \textcolor{comment}{// subject to}}
\DoxyCodeLine{126   \textcolor{comment}{//   A x = b}}
\DoxyCodeLine{127   \textcolor{comment}{//   x(i) = bc(i) iff k(i)==true}}
\DoxyCodeLine{128   \textcolor{comment}{//}}
\DoxyCodeLine{129   \textcolor{comment}{// Templates:}}
\DoxyCodeLine{130   \textcolor{comment}{//   Scalar  (e.g., double)}}
\DoxyCodeLine{131   \textcolor{comment}{//   n  \#H or Eigen::Dynamic if not known at compile time}}
\DoxyCodeLine{132   \textcolor{comment}{//   m  \#A or Eigen::Dynamic if not known at compile time}}
\DoxyCodeLine{133   \textcolor{comment}{//   Hpd  whether H is positive definite (LLT used) or not (QR used)}}
\DoxyCodeLine{134   \textcolor{comment}{// Inputs:}}
\DoxyCodeLine{135   \textcolor{comment}{//   H  \#H by \#H quadratic coefficients (only lower triangle used)}}
\DoxyCodeLine{136   \textcolor{comment}{//   f  \#H linear coefficients}}
\DoxyCodeLine{137   \textcolor{comment}{//   k  \#H list of flags whether to fix value}}
\DoxyCodeLine{138   \textcolor{comment}{//   bc  \#H value to fix to (if !k(i) then bc(i) is ignored)}}
\DoxyCodeLine{139   \textcolor{comment}{//   A  \#A by \#H list of linear equality constraint coefficients, must be}}
\DoxyCodeLine{140   \textcolor{comment}{//     linearly independent (with self and fixed value constraints)}}
\DoxyCodeLine{141   \textcolor{comment}{//   b  \#A list of linear equality right-\/hand sides}}
\DoxyCodeLine{142   \textcolor{comment}{// Returns \#H-\/long solution x}}
\DoxyCodeLine{143   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar, \textcolor{keywordtype}{int} n, \textcolor{keywordtype}{int} m, \textcolor{keywordtype}{bool} Hpd=true>}
\DoxyCodeLine{144   IGL\_INLINE Eigen::Matrix<Scalar,n,1> min\_quad\_with\_fixed(}
\DoxyCodeLine{145     \textcolor{keyword}{const} Eigen::Matrix<Scalar,n,n> \& H,}
\DoxyCodeLine{146     \textcolor{keyword}{const} Eigen::Matrix<Scalar,n,1> \& f,}
\DoxyCodeLine{147     \textcolor{keyword}{const} Eigen::Array<bool,n,1> \& k,}
\DoxyCodeLine{148     \textcolor{keyword}{const} Eigen::Matrix<Scalar,n,1> \& bc,}
\DoxyCodeLine{149     \textcolor{keyword}{const} Eigen::Matrix<Scalar,m,n> \& A,}
\DoxyCodeLine{150     \textcolor{keyword}{const} Eigen::Matrix<Scalar,m,1> \& b);}
\DoxyCodeLine{151   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar, \textcolor{keywordtype}{int} n, \textcolor{keywordtype}{bool} Hpd=true>}
\DoxyCodeLine{152   IGL\_INLINE Eigen::Matrix<Scalar,n,1> min\_quad\_with\_fixed(}
\DoxyCodeLine{153     \textcolor{keyword}{const} Eigen::Matrix<Scalar,n,n> \& H,}
\DoxyCodeLine{154     \textcolor{keyword}{const} Eigen::Matrix<Scalar,n,1> \& f,}
\DoxyCodeLine{155     \textcolor{keyword}{const} Eigen::Array<bool,n,1> \& k,}
\DoxyCodeLine{156     \textcolor{keyword}{const} Eigen::Matrix<Scalar,n,1> \& bc);}
\DoxyCodeLine{157   \textcolor{comment}{// Special wrapper where the number of constrained values (i.e., true values}}
\DoxyCodeLine{158   \textcolor{comment}{// in k) is exposed as a template parameter. Not intended to be called}}
\DoxyCodeLine{159   \textcolor{comment}{// directly. The overhead of calling the overloads above is already minimal.}}
\DoxyCodeLine{160   \textcolor{keyword}{template} <\textcolor{keyword}{typename} Scalar, \textcolor{keywordtype}{int} n, \textcolor{keywordtype}{int} kcount, \textcolor{keywordtype}{bool} Hpd\textcolor{comment}{/*no default*/}>}
\DoxyCodeLine{161   IGL\_INLINE Eigen::Matrix<Scalar,n,1> min\_quad\_with\_fixed(}
\DoxyCodeLine{162     \textcolor{keyword}{const} Eigen::Matrix<Scalar,n,n> \& H,}
\DoxyCodeLine{163     \textcolor{keyword}{const} Eigen::Matrix<Scalar,n,1> \& f,}
\DoxyCodeLine{164     \textcolor{keyword}{const} Eigen::Array<bool,n,1> \& k,}
\DoxyCodeLine{165     \textcolor{keyword}{const} Eigen::Matrix<Scalar,n,1> \& bc);}
\DoxyCodeLine{166 \}}
\DoxyCodeLine{167 }
\DoxyCodeLine{168 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{169 \textcolor{keyword}{struct }\mbox{\hyperlink{structigl_1_1min__quad__with__fixed__data}{igl::min\_quad\_with\_fixed\_data}}}
\DoxyCodeLine{170 \{}
\DoxyCodeLine{171   \textcolor{comment}{// Size of original system: number of unknowns + number of knowns}}
\DoxyCodeLine{172   \textcolor{keywordtype}{int} n;}
\DoxyCodeLine{173   \textcolor{comment}{// Whether A(unknown,unknown) is positive definite}}
\DoxyCodeLine{174   \textcolor{keywordtype}{bool} Auu\_pd;}
\DoxyCodeLine{175   \textcolor{comment}{// Whether A(unknown,unknown) is symmetric}}
\DoxyCodeLine{176   \textcolor{keywordtype}{bool} Auu\_sym;}
\DoxyCodeLine{177   \textcolor{comment}{// Indices of known variables}}
\DoxyCodeLine{178   Eigen::VectorXi known;}
\DoxyCodeLine{179   \textcolor{comment}{// Indices of unknown variables}}
\DoxyCodeLine{180   Eigen::VectorXi unknown;}
\DoxyCodeLine{181   \textcolor{comment}{// Indices of lagrange variables}}
\DoxyCodeLine{182   Eigen::VectorXi lagrange;}
\DoxyCodeLine{183   \textcolor{comment}{// Indices of unknown variable followed by Indices of lagrange variables}}
\DoxyCodeLine{184   Eigen::VectorXi unknown\_lagrange;}
\DoxyCodeLine{185   \textcolor{comment}{// Matrix multiplied against Y when constructing right hand side}}
\DoxyCodeLine{186   Eigen::SparseMatrix<T> preY;}
\DoxyCodeLine{187   \textcolor{keyword}{enum} SolverType}
\DoxyCodeLine{188   \{}
\DoxyCodeLine{189     LLT = 0,}
\DoxyCodeLine{190     LDLT = 1,}
\DoxyCodeLine{191     LU = 2,}
\DoxyCodeLine{192     QR\_LLT = 3,}
\DoxyCodeLine{193     NUM\_SOLVER\_TYPES = 4}
\DoxyCodeLine{194   \} solver\_type;}
\DoxyCodeLine{195   \textcolor{comment}{// Solvers}}
\DoxyCodeLine{196   Eigen::SimplicialLLT <Eigen::SparseMatrix<T > > llt;}
\DoxyCodeLine{197   Eigen::SimplicialLDLT<Eigen::SparseMatrix<T > > ldlt;}
\DoxyCodeLine{198   Eigen::SparseLU<Eigen::SparseMatrix<T, Eigen::ColMajor>, Eigen::COLAMDOrdering<int> >   lu;}
\DoxyCodeLine{199   \textcolor{comment}{// QR factorization}}
\DoxyCodeLine{200   \textcolor{comment}{// Are rows of Aeq linearly independent?}}
\DoxyCodeLine{201   \textcolor{keywordtype}{bool} Aeq\_li;}
\DoxyCodeLine{202   \textcolor{comment}{// Columns of Aeq corresponding to unknowns}}
\DoxyCodeLine{203   \textcolor{keywordtype}{int} neq;}
\DoxyCodeLine{204   Eigen::SparseQR<Eigen::SparseMatrix<T>, Eigen::COLAMDOrdering<int> >  AeqTQR;}
\DoxyCodeLine{205   Eigen::SparseMatrix<T> Aeqk;}
\DoxyCodeLine{206   Eigen::SparseMatrix<T> Aequ;}
\DoxyCodeLine{207   Eigen::SparseMatrix<T> Auu;}
\DoxyCodeLine{208   Eigen::SparseMatrix<T> AeqTQ1;}
\DoxyCodeLine{209   Eigen::SparseMatrix<T> AeqTQ1T;}
\DoxyCodeLine{210   Eigen::SparseMatrix<T> AeqTQ2;}
\DoxyCodeLine{211   Eigen::SparseMatrix<T> AeqTQ2T;}
\DoxyCodeLine{212   Eigen::SparseMatrix<T> AeqTR1;}
\DoxyCodeLine{213   Eigen::SparseMatrix<T> AeqTR1T;}
\DoxyCodeLine{214   Eigen::SparseMatrix<T> AeqTE;}
\DoxyCodeLine{215   Eigen::SparseMatrix<T> AeqTET;}
\DoxyCodeLine{216   \textcolor{comment}{// Debug}}
\DoxyCodeLine{217   Eigen::SparseMatrix<T> NA;}
\DoxyCodeLine{218   Eigen::Matrix<T,Eigen::Dynamic,Eigen::Dynamic> NB;}
\DoxyCodeLine{219 \};}
\DoxyCodeLine{220 }
\DoxyCodeLine{221 \textcolor{preprocessor}{\#ifndef IGL\_STATIC\_LIBRARY}}
\DoxyCodeLine{222 \textcolor{preprocessor}{\#  include "{}min\_quad\_with\_fixed.impl.h"{}}}
\DoxyCodeLine{223 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{224 }
\DoxyCodeLine{225 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
